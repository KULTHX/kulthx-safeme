name: Deploy to Koyeb

on:
  push:
    branches:
      - main

env:
  KOYEB_APP_NAME: kulthx-safeme
  KOYEB_SERVICE_NAME: web

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install

    - name: Build project
      run: npm run build

    - name: Deploy to Koyeb
      uses: koyeb/action-deploy@v1
      with:
        api_token: ${{ secrets.KOYEB_API_TOKEN }}
        app_name: ${{ env.KOYEB_APP_NAME }}
        service_name: ${{ env.KOYEB_SERVICE_NAME }}
        build_command: 'npm run build'
        run_command: 'npm start'
        environment_variables: |
          GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}
          GITHUB_OWNER=nizartitwaniii
          GITHUB_REPO=kulthx-safeme
          PORT=5000


